# SH004/checkbox-state

## Description

`SH004` enforces task checkbox state from frontmatter-defined document state conditions.

Each configured condition maps frontmatter states to an expected checkbox state:

- `checked: true` means all task checkboxes must be checked (`[x]`/`[X]`).
- `checked: false` means all task checkboxes must be unchecked (`[ ]`).

## Failing Example

```markdown
---
status: ready-for-review
state_reason: success
---

- [ ] finalize acceptance criteria
```

## Passing Example

```markdown
---
status: proposed
lifecycle: draft
---

- [ ] draft task intentionally open
```

## Configuration

- `scan_fenced_code` (`boolean`, default `false`): include task checkboxes inside fenced code blocks.
- `conditions` (`array`): ordered condition list; first matching condition wins.
  - `states` (`object`): frontmatter key to expected value (`string`, `number`, `boolean`, or array of those).
    - Use dot-path keys for nested fields (example: `compliance.profiles.fisma.certification`).
  - `checked` (`boolean`): expected checkbox state when the condition matches.

### Condition Logic

Matching semantics are:

- `conditions`: logical OR (first matching condition wins).
- keys inside `states`: logical AND (every key in that condition must match).
- values for each key (`[...]`): logical OR (any listed value matches).

Equivalent expression for one condition:

`(status in [...]) AND (state_reason in [...]) AND ...`

Equivalent expression for multiple conditions:

`condition_1 OR condition_2 OR condition_3 ...`

```yaml
scan_fenced_code: false
conditions:
  - states:
      status: ready-for-review
      state_reason: completed
    checked: true
  - states:
      compliance.profiles.fisma.certification: true
      status: completed
    checked: true
  - states:
      lifecycle: draft
      status: proposed
    checked: false
```

## Notes

- Condition matching is case-insensitive.
- A condition matches only when all its `states` entries match (logical AND).
- Use multiple conditions to express logical OR across different state combinations.
- If `conditions` is omitted/empty, or no condition matches, the rule is a no-op.
